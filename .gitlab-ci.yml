include:
  - "https://gitlab.com/accessable-net/gitlab-ci-templates/-/raw/master/android.yml"
  - "https://gitlab.com/accessable-net/gitlab-ci-templates/-/raw/master/scheduled_rebase.yml"

.checkout-deagle: &checkout_deagle
  - git clone https://github.com/oasisfeng/deagle ../deagle -b dev

.checkout-setupwizard: &checkout_setupwizard
  - git clone https://android.googlesource.com/platform/frameworks/opt/setupwizard ../setup-wizard

variables:
  GRADLE_OPTS: -Dorg.gradle.daemon=false
  UPSTREAM_BRANCH: dev

AssembleDebug:
  extends:
    - .android-base
  stage: build
  script:
    - *checkout_deagle
    - *checkout_setupwizard
    - ./gradlew assembleCompleteDebug
  artifacts:
    paths:
      - ./assembly/build/outputs/

AssembleRelease:
  extends:
    - .android-base
  script:
    - *checkout_deagle
    - *checkout_setupwizard
    - base64 -d $KEYSTORE_FILE > my.keystore
    - ./gradlew assembleCompleteRelease -Pandroid.injected.signing.store.file=$(pwd)/my.keystore -Pandroid.injected.signing.store.password=$KEYSTORE_PASSWORD -Pandroid.injected.signing.key.alias=$KEY_ALIAS -Pandroid.injected.signing.key.password=$KEY_PASSWORD
  artifacts:
    paths:
      - ./assembly/build/outputs/
